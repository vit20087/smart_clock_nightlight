# üí° –†–æ–∑—É–º–Ω–∏–π –≥–æ–¥–∏–Ω–Ω–∏–∫ —Ç–∞ –Ω—ñ—á–Ω–∏–∫ ESP32: Smart-Clock & Nightlight

## üìò –û–≥–ª—è–¥ –ü—Ä–æ—î–∫—Ç—É

–¶–µ–π –ø—Ä–æ—î–∫—Ç –ø–æ—î–¥–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–æ—á–Ω–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –≥–æ–¥–∏–Ω–Ω–∏–∫–∞, –∫—ñ–º–Ω–∞—Ç–Ω–æ–≥–æ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–∞ —Ç–∞ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –Ω—ñ—á–Ω–∏–∫–∞.
–°–∏—Å—Ç–µ–º–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ ESP32 —ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î:

- –±–∞–≥–∞—Ç–æ–∑–∞–¥–∞—á–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ FreeRTOS
- —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ –¥–∞—Ç—á–∏–∫–∞–º–∏ (RTC, –æ—Å–≤—ñ—Ç–ª–µ–Ω—ñ—Å—Ç—å, —Ä—É—Ö)
- –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- PWM-–∫–æ–Ω—Ç—Ä–æ–ª—å RGBW —Å—Ç—Ä—ñ—á–∫–∏

---

# üìê –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ö–æ–¥—É

–ü—Ä–æ—î–∫—Ç —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ **Clean Code**, _Separation of Concerns_ —ñ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—ñ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ö–∞—Ç–∞–ª–æ–≥—ñ–≤ (ESP-IDF)

```text
.
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ app_config.h             // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ (GPIO, I2C, WiFi)
‚îÇ   ‚îú‚îÄ‚îÄ main.c                   // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –∑–∞–ø—É—Å–∫ FreeRTOS-–∑–∞–≤–¥–∞–Ω—å
‚îÇ   ‚îú‚îÄ‚îÄ drivers/                 // –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤—ñ –¥—Ä–∞–π–≤–µ—Ä–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ds3231/              // RTC –¥—Ä–∞–π–≤–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bh1750/              // –î—Ä–∞–π–≤–µ—Ä –¥–∞—Ç—á–∏–∫–∞ –æ—Å–≤—ñ—Ç–ª–µ–Ω–æ—Å—Ç—ñ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rcwl0516/            // –î–∞—Ç—á–∏–∫ —Ä—É—Ö—É (–º—ñ–∫—Ä–æ—Ö–≤–∏–ª—å–æ–≤–∏–π)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rgbw_pwm/            // PWM –¥–ª—è RGBW —Å—Ç—Ä—ñ—á–∫–∏ —á–µ—Ä–µ–∑ LEDC
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ oled_u8g2/           // OLED –¥–∏—Å–ø–ª–µ–π (u8g2 –∞–¥–∞–ø—Ç–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ components/              // –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —Å—Ç–∞–Ω, –º–µ—Ä–µ–∂–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_state/           // –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –ø—Ä–æ–≥—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ web_server/          // HTTP —Å–µ—Ä–≤–µ—Ä + –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_clock/          // –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è –≥–æ–¥–∏–Ω–Ω–∏–∫–∞ —Ç–∞ –µ–∫—Ä–∞–Ω—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_light/          // –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Å—Ç—Ä—ñ—á–∫–∏ —Ç–∞ –¥–∞—Ç—á–∏–∫—ñ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ u8g2                 // –î—Ä–∞–π–≤–µ—Ä –¥–ª—è OLED-LCD-–µ–∫—Ä–∞–Ω—É
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ u8g2-hal-esp-idf     // –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è OLED-–¥—Ä–∞–π–≤–µ—Ä—É –ø—ñ–¥ ESP-IDF
‚îÇ   ‚îî‚îÄ‚îÄ Kconfig                  // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è menuconfig
‚îî‚îÄ‚îÄ CMakeLists.txt               // –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ—î–∫—Ç—É
```

---

# üß© –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –ú–æ–¥—É–ª—ñ–≤

## **Drivers**

–ú–æ–¥—É–ª—ñ: `ds3231`, `bh1750`, `rcwl0516`, `rgbw_pwm`, `oled_u8g2`
–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:

- –†–æ–±–æ—Ç–∞ –∑ I2C —Ç–∞ GPIO
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏—Ö –¥–∞–Ω–∏—Ö
- –ö–æ–Ω—Ç—Ä–æ–ª—å PWM, –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä—ñ–≤

## **Components ‚Üí app_state**

- –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
- –°–µ–º–∞—Ñ–æ—Ä–∏/–º'—é—Ç–µ–∫—Å–∏ –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ—Å—Ç—ñ

## **Components ‚Üí web_server**

- –û–±—Ä–æ–±–∫–∞ HTTP-–∑–∞–ø–∏—Ç—ñ–≤
- JSON-API
- –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ app_state

## **Components ‚Üí task_clock / task_light**

- –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
- –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (FreeRTOS tasks)

---

# ‚öôÔ∏è FreeRTOS –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –º–∞—î –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ö –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω–Ω—è:

### **‚è±Ô∏è Clock Task**

- –ß–∏—Ç–∞–Ω–Ω—è —á–∞—Å—É –∑ DS3231
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è OLED –¥–∏—Å–ø–ª–µ—é
- –†–æ–±–æ—Ç–∞ —Ç–∞–π–º–µ—Ä–∞/—Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä–∞

### **üí° Light Task**

- –ö–µ—Ä—É–≤–∞–Ω–Ω—è RGBW —Å—Ç—Ä—ñ—á–∫–æ—é —á–µ—Ä–µ–∑ PWM
- –ê–Ω–∞–ª—ñ–∑ –æ—Å–≤—ñ—Ç–ª–µ–Ω–æ—Å—Ç—ñ (BH1750)
- –†–µ–∞–∫—Ü—ñ—è –Ω–∞ —Ä—É—Ö (RCWL-0516)

---

# üîß –û—Å–Ω–æ–≤–Ω—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### üïí **–ì–æ–¥–∏–Ω–Ω–∏–∫ —Ç–∞ –µ–∫—Ä–∞–Ω**

- –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å, –¥–∞—Ç–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
- –®—Ä–∏—Ñ—Ç–∏ —Ç–∞ –≥—Ä–∞—Ñ—ñ–∫–∞ –≤—ñ–¥ u8g2

### üí° **–Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–µ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å –∑–∞ BH1750
- –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –ø—Ä–∏ —Ä—É—Å—ñ
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–ª—å–æ—Ä—É —Ç–∞ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ –∑ –≤–µ–±-–ø–∞–Ω–µ–ª—ñ

### üåê **–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

- –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å RGBW
- –í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—ñ–≤ —Ä–æ–±–æ—Ç–∏:

  - —Ä—É—Ö
  - –∞–≤—Ç–æ—Å–≤—ñ—Ç–ª–æ
  - —Ä—É—á–Ω–∏–π

- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–æ–¥–∏–Ω–Ω–∏–∫–∞
- –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è/–≤–∏–º–∫–Ω–µ–Ω–Ω—è OLED
- –¢–∞–π–º–µ—Ä–∏ —Ç–∞ –∑–∞—Ç—Ä–∏–º–∫–∏

---

# üõ†Ô∏è –°–ø–∏—Å–æ–∫ –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –ö—ñ–ª—å–∫—ñ—Å—Ç—å | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è             |
| ---------------- | --------- | ----------------------- |
| ESP32            | 2         | –û—Å–Ω–æ–≤–Ω–∏–π –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä |
| DS3231           | 1         | RTC + —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞       |
| BH1750           | 1         | –î–∞—Ç—á–∏–∫ –æ—Å–≤—ñ—Ç–ª–µ–Ω–æ—Å—Ç—ñ     |
| RCWL-0516        | 1         | –î–∞—Ç—á–∏–∫ —Ä—É—Ö—É             |
| OLED (u8g2)      | 1         | –î–∏—Å–ø–ª–µ–π                 |
| RGBW —Å—Ç—Ä—ñ—á–∫–∞ 12–í | 1–º        | –ù—ñ—á–Ω–∏–∫                  |
| –¢—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä–∏ NPN  | 4         | PWM-–∫–µ—Ä—É–≤–∞–Ω–Ω—è           |
| –†–µ–∑–∏—Å—Ç–æ—Ä–∏ 1 –∫–û–º  | 4         | –û–±–≤‚Äô—è–∑–∫–∞ —Å—Ç—Ä—ñ—á–∫–∏        |
| –ü–ª–∞—Ç–∞ –∂–∏–≤–ª–µ–Ω–Ω—è   | 1         | 12–í –¥–ª—è RGBW            |

---

# üíª –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ú–æ–¥—É–ª—ñ–≤

## 1. **DS3231 Clock**

- –í–ª–∞—Å–Ω–∏–π –¥—Ä–∞–π–≤–µ—Ä
- –ß–∏—Ç–∞–Ω–Ω—è —á–∞—Å—É/–¥–∞—Ç–∏
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ñ–¥ RTC
- –ö–∞–ª—ñ–±—Ä–æ–≤–∫–∞ –¥—Ä–µ–π—Ñ—É

## 2. **OLED –î–∏—Å–ø–ª–µ–π**

- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ u8g2
- –ì—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ç–µ–∫—Å—Ç
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —à—Ä–∏—Ñ—Ç—ñ–≤
- –ë—ñ—Ç–º–∞–ø–∏ –¥–ª—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

## 3. **RGBW PWM**

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è LEDC (–∞–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ PWM ESP32)
- –ß–∞—Å—Ç–æ—Ç–∞ —Ç–∞ —Ä–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å PWM
- –í–µ–±-–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É

## 4. **–î–∞—Ç—á–∏–∫–∏**

- BH1750: I2C –æ—Å–≤—ñ—Ç–ª–µ–Ω—ñ—Å—Ç—å
- RCWL-0516: —Ç—Ä–∏–≥–µ—Ä —Ä—É—Ö—É

## 5. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**

- HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ ESP-IDF
- –ü—Ä–æ—Å—Ç–∏–π UI + JSON API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É

---

# üì¶ –ü–ª–∞–Ω–∏ —Ç–∞ –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

- WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
- –ê–Ω—ñ–º–∞—Ü—ñ—ó —Å—Ç—Ä—ñ—á–∫–∏
- OTA-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤ SPIFFS

---

# üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT (–∑–∞ –±–∞–∂–∞–Ω–Ω—è–º –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏)

---